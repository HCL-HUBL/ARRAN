manifest {
    name = "HCL-GWAS"
    author = "Corentin Molitor"
    homePage = "https://github.com/HCL-HUBL/HCL-GWAS"
    description = "Nextflow to perform GWAS analyses"
    mainScript = "HCL-GWAS.nf"
    version = "0.1.2"
    nextflowVersion = "21+"
}

executor {
    name = 'local'
    cpus = 25
    memory = "100GB"
}

singularity {
	enabled = true
}

process {
    executor = 'local'

    time = "24h"

    cpus = 1
    maxForks = 25
    memory = "6GB"

    container = "${projectDir}/HCL-GWAS_20250224-152241.simg"
}

params {
    // General options:
    plink_fileset = "${launchDir}/EUR_height.{bed,bim,fam}"
    covar_file    = "${launchDir}/EUR_height.covars"    // Path to file listing the covariates to be included in the model
    out_basename  = "hcl_gwas_test"                          // Basename of the output files
    outdir        = "${launchDir}/results/"             // Output folder which will contain all results
    genome_build  = "hg19"                              // Accepts 'hg19' or 'hg38', used to define PAR regions
    trait_type    = "quantitative"                      // Trait type, must be 'binary' or 'quantitative'

    // QC options:
    qc_mind      = 0.05                   // Individuals with missing genotypes > 'qc_mind' will be removed
    qc_geno      = 0.05                   // Variants with missing genotypes > 'qc_geno' will be removed
    qc_remove    = ""                     // (optional) File listing IIDs and FIDs of individuals to be excluded
    qc_hetfilter = "both"                 // Heterozygosity filter, must be "none", "low", "high" or "both", cf: ./bin/het_check.R
    qc_hwe       = 5e-6                   // Variants with an exact test p-value < 'qc_hwe' will be flagged (added to a file for further inspection) 

    // Pruning options:
    pr_window    = 200                    // Window size for the pruning, in number of variants
    pr_step      = 50                     // Window sliding size in number of variants
    pr_r2        = 0.25                   // Pairs of variants with r2 > 'pr_r2' will be removed

    // MAF options:
    gwas_maf     = 0.01                   // Variants with a MAF < 'qc_maf' will be removed for the GWAS analysis
    rvat_maf     = 0.01                   // (deprecated) Variants with a MAF > 'rvat_maf' will be removed for the rare variants analysis

    // Admixture:
    admixture_K = 3                       // Number of expected populations in the dataset

    // SAIGE options
    saige_covar  = "PC1,PC2,PC3,PC4,PC5"        // List of all covariates to include in the model, comma separated
    saige_qcovar = ""                           // List the covariates which are categorical 
    saige_regions = "${launchDir}/regions.bed"  // (optional) list of regions to analyse (bed format)
    saige_extension = 5                         // When assigning SNPs to genes, extends the gene bounds by this many kbp (default 5)

    tools {
        plink = "/opt/progrs/plink"
        admixture = "/opt/progrs/dist/admixture_linux-1.3.0/admixture"
        R = "R"
        Rscript = "Rscript"
        saige_folder = "/usr/local/bin/"  // Folder where 'step1_fitNULLGLMM.R', 'step2_SPAtests.R' and 'createSparseGRM.R' are located
    }
}