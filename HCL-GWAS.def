Bootstrap: docker
From: wzhou88/saige:1.3.6

# sudo singularity build HCL-GWAS_$(date '+%Y%m%d-%H%M%S').simg HCL-GWAS.def

%labels
	Author Corentin
	But Singularity image to support the HCL-GWAS nextflow pipeline
	Version 0.4

%environment
        # SAIGE uses a script to install the R packages dependencies,
        # we need to tell singularity where to install them:
        export R_LIBS_USER='/opt/R/x86_64-pc-linux-gnu-library/4.2/'

%setup
	mkdir -p ${SINGULARITY_ROOTFS}/opt/R/x86_64-pc-linux-gnu-library/4.2/
	mkdir -p ${SINGULARITY_ROOTFS}/opt/progrs/

%post
	export DEBIAN_FRONTEND=noninteractive
	export ROOT_PATH=$(pwd)

	apt-get update
	apt-get -y upgrade

	### setting to local (required for perl and R) to fr:
	echo 'export LANGUAGE=C' >> $SINGULARITY_ENVIRONMENT
	echo 'export LANG=C.UTF-8' >> $SINGULARITY_ENVIRONMENT
	echo 'export LC_ALL=C.UTF-8' >> $SINGULARITY_ENVIRONMENT

	# Generic tools:
	apt-get install -y build-essential wget unzip cmake make curl bzip2 libbz2-dev
	apt-get install -y libfontconfig1-dev gfortran libxml2 libxml2-dev

	# R packages:
	R --slave -e 'install.packages("optparse", repos = "https://cloud.r-project.org/")'
	R --slave -e 'install.packages("ggplot2", repos = "https://cloud.r-project.org/")'
	R --slave -e 'install.packages("qqman", repos= "https://cloud.r-project.org/")'

	# Plink 1.9
	cd /opt/progrs/
	wget --tries=0 -P /opt/progrs/ https://s3.amazonaws.com/plink1-assets/plink_linux_x86_64_20241022.zip
	unzip plink_linux_x86_64_20241022.zip

	### cleaning
	apt-get -y autoremove --purge					# désinstalle toutes les dépendances devenues inutiles et leurs fichiers de configuration
	apt-get -y clean						# supprime la totalité des paquets présents dans /var/cache/apt/archives
